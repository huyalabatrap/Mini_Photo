{% extends "_base.html" %}

{% block title %}K·∫øt qu·∫£ ph√¢n ƒëo·∫°n - Segmentation Studio{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">‚ú® K·∫øt qu·∫£ ph√¢n ƒëo·∫°n</h1>
    <p class="page-subtitle">Ph∆∞∆°ng ph√°p: <strong>{{ method }}</strong> ‚Ä¢ Job ID: <code>{{ job_id }}</code></p>
</div>

<!-- Results Grid -->
<div class="results-grid">
    <!-- Original Image Panel -->
    <div class="result-panel">
        <div class="panel-header">
            <h3 class="panel-title">
                <span class="panel-icon">üñºÔ∏è</span>
                ·∫¢nh g·ªëc
            </h3>
        </div>
        <div class="panel-body">
            <div class="image-container">
                <img 
                    src="{{ url_for('static', filename=input_path.replace('static/', '').replace('static\\', '').replace('\\', '/')) }}" 
                    alt="·∫¢nh g·ªëc" 
                    class="result-image"
                    loading="lazy"
                >
            </div>
        </div>
    </div>

    <!-- Mask Panel -->
    <div class="result-panel">
        <div class="panel-header">
            <h3 class="panel-title">
                <span class="panel-icon">üé≠</span>
                Mask ph√¢n ƒëo·∫°n
            </h3>
        </div>
        <div class="panel-body">
            <div class="image-container">
                <img 
                    src="{{ url_for('static', filename=result_path.replace('static/', '').replace('static\\', '').replace('\\', '/')) }}" 
                    alt="Mask ph√¢n ƒëo·∫°n" 
                    class="result-image"
                    loading="lazy"
                >
            </div>
        </div>
    </div>

    <!-- Overlay Panel (if exists) -->
    {% if overlay_path %}
    <div class="result-panel">
        <div class="panel-header">
            <h3 class="panel-title">
                <span class="panel-icon">üî¥</span>
                Overlay
            </h3>
        </div>
        <div class="panel-body">
            <div class="image-container">
                <img 
                    src="{{ url_for('static', filename=overlay_path.replace('static/', '').replace('static\\', '').replace('\\', '/')) }}" 
                    alt="Overlay v·ªõi contour" 
                    class="result-image"
                    loading="lazy"
                >
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Cutout Panel (if exists) -->
    {% if cutout_path %}
    <div class="result-panel">
        <div class="panel-header">
            <h3 class="panel-title">
                <span class="panel-icon">‚úÇÔ∏è</span>
                Cutout (PNG)
            </h3>
        </div>
        <div class="panel-body">
            <div class="image-container cutout-container">
                <div class="transparency-bg"></div>
                <img 
                    src="{{ url_for('static', filename=cutout_path.replace('static/', '').replace('static\\', '').replace('\\', '/')) }}" 
                    alt="Cutout v·ªõi n·ªÅn trong su·ªët" 
                    class="result-image cutout-image"
                    loading="lazy"
                >
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Statistics Section -->
<div class="stats-section">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <span class="card-icon">üìä</span>
                Th·ªëng k√™ ph√¢n ƒëo·∫°n
            </h2>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Ph∆∞∆°ng ph√°p</div>
                    <div class="stat-value method-badge">{{ method }}</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">S·ªë v√πng</div>
                    <div class="stat-value">{{ stats.num_regions or 'N/A' }}</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">Di·ªán t√≠ch (pixels)</div>
                    <div class="stat-value">{{ "{:,}".format(stats.area_pixels) if stats.area_pixels else 'N/A' }}</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">T·ª∑ l·ªá foreground</div>
                    <div class="stat-value">{{ "{:.2%}".format(stats.foreground_ratio) if stats.foreground_ratio else 'N/A' }}</div>
                </div>
            </div>

            <!-- Additional Stats (if available) -->
            {% if stats.method_specific %}
            <div class="additional-stats">
                <h4 class="additional-title">Chi ti·∫øt ph∆∞∆°ng ph√°p</h4>
                <div class="additional-content">
                    <span class="additional-badge">{{ stats.method_specific }}</span>
                    {% if stats.clusters %}
                        <span class="additional-badge">{{ stats.clusters }} clusters</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Download Section -->
<div class="download-section">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <span class="card-icon">üíæ</span>
                T·∫£i xu·ªëng k·∫øt qu·∫£
            </h2>
        </div>
        <div class="card-body">
            <div class="download-grid">
                <!-- Mask Download -->
                <a 
                    href="{{ url_for('download_file', filename=result_path|get_filename) }}" 
                    class="download-btn btn-mask"
                    download
                >
                    <span class="download-icon">üé≠</span>
                    <div class="download-content">
                        <div class="download-title">Mask ph√¢n ƒëo·∫°n</div>
                        <div class="download-subtitle">PNG ‚Ä¢ Binary mask</div>
                    </div>
                </a>

                <!-- Cutout Download (if exists) -->
                {% if cutout_path %}
                <a 
                    href="{{ url_for('download_file', filename=cutout_path|get_filename) }}" 
                    class="download-btn btn-cutout"
                    download
                >
                    <span class="download-icon">‚úÇÔ∏è</span>
                    <div class="download-content">
                        <div class="download-title">Cutout RGBA</div>
                        <div class="download-subtitle">PNG ‚Ä¢ N·ªÅn trong su·ªët</div>
                    </div>
                </a>
                {% endif %}

                <!-- Overlay Download (if exists) -->
                {% if overlay_path %}
                <a 
                    href="{{ url_for('download_file', filename=overlay_path|get_filename) }}" 
                    class="download-btn btn-overlay"
                    download
                >
                    <span class="download-icon">üî¥</span>
                    <div class="download-content">
                        <div class="download-title">Overlay</div>
                        <div class="download-subtitle">PNG ‚Ä¢ Contour ƒë·ªè</div>
                    </div>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Actions Section -->
<div class="actions-section">
    <div class="actions-container">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            <span class="btn-text">Quay l·∫°i trang ch·ªß</span>
        </a>
        
        <button class="btn btn-primary" onclick="window.print()">
            <span class="btn-icon">üñ®Ô∏è</span>
            <span class="btn-text">In k·∫øt qu·∫£</span>
        </button>
    </div>
</div>

<!-- Image Modal for Full View -->
<div id="imageModal" class="modal hidden" onclick="closeModal()">
    <div class="modal-content">
        <img id="modalImage" src="" alt="Full size image">
        <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
</div>

<script>
// Image modal functionality
document.querySelectorAll('.result-image').forEach(img => {
    img.addEventListener('click', function() {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        modal.classList.remove('hidden');
        modalImg.src = this.src;
        modalImg.alt = this.alt;
    });
    
    // Add click cursor
    img.style.cursor = 'pointer';
});

function closeModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

// Keyboard support for modal
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeModal();
    }
});
</script>
{% endblock %}
